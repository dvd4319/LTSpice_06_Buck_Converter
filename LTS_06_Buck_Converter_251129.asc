Version 4.1
SHEET 1 2768 1128
WIRE 1760 -144 1552 -144
WIRE 432 -128 48 -128
WIRE 608 -128 432 -128
WIRE 1552 -80 1552 -144
WIRE 608 -64 608 -128
WIRE 352 16 256 16
WIRE 528 16 432 16
WIRE 560 16 528 16
WIRE 1552 32 1552 0
WIRE 256 80 256 16
WIRE 1392 80 1360 80
WIRE 1728 80 1392 80
WIRE 1760 80 1760 -144
WIRE 2016 96 1792 96
WIRE 48 112 48 -128
WIRE 1728 112 1616 112
WIRE 1360 128 1360 80
WIRE 608 160 608 32
WIRE 864 160 608 160
WIRE 912 160 864 160
WIRE 1088 160 992 160
WIRE 1168 160 1088 160
WIRE 1200 160 1168 160
WIRE 1616 208 1616 112
WIRE 1760 208 1760 112
WIRE 864 224 864 160
WIRE 1088 224 1088 160
WIRE 1360 240 1360 208
WIRE 256 256 256 160
WIRE 608 256 608 160
WIRE 608 256 256 256
WIRE 1200 256 1200 160
WIRE 48 352 48 192
WIRE 864 352 864 288
WIRE 864 352 48 352
WIRE 1088 352 1088 288
WIRE 1088 352 864 352
WIRE 1200 352 1200 336
WIRE 1200 352 1088 352
WIRE 1360 352 1360 320
WIRE 1616 352 1616 288
WIRE 1088 400 1088 352
FLAG 608 160 source
FLAG 528 16 gate
FLAG 1168 160 out
FLAG 1616 352 0
FLAG 1360 352 0
FLAG 1552 32 0
FLAG 1088 400 0
FLAG 2016 96 pwm
FLAG 1760 208 0
FLAG 1392 80 in
FLAG 432 -128 .dc
DATAFLAG 1168 160 ""
SYMBOL voltage 48 96 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 10
SYMBOL voltage 1616 192 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value PULSE(0 10 0 4.8u 0.2u 0 5u)
SYMBOL res 448 0 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 10
SYMBOL ind 896 176 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 50µ
SYMATTR SpiceLine Rser=0.05
SYMBOL res 1184 240 R0
SYMATTR InstName R2
SYMATTR Value 1
SYMBOL cap 1072 224 R0
SYMATTR InstName C1
SYMATTR Value 10µ
SYMATTR SpiceLine Rser=0.15
SYMBOL voltage 1552 -96 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 15
SYMBOL nmos 560 -64 R0
SYMATTR InstName M1
SYMATTR Value IRFZ48N
SYMBOL diode 880 288 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMATTR Value MBR735
SYMBOL voltage 1360 224 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 0 6 15 Left 2
WINDOW 3 44 55 Left 2
SYMATTR InstName Duty
SYMATTR Value 5.4
SYMBOL bv 256 64 R0
SYMATTR InstName Edriver
SYMATTR Value V={V(pwm)}
SYMBOL MyComparator 1760 96 R0
SYMATTR InstName U1
SYMBOL voltage 1360 112 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 43 57 Left 2
SYMATTR Value SINE(0 2 50k)
SYMATTR InstName V4
TEXT 824 48 Left 2 !.tran 0 {t0+5/Freq} {t0} 0.1u
TEXT 1640 320 Left 2 ;sawtooth
TEXT 896 224 Left 2 ;ESR=0.05
TEXT 1024 320 Left 2 ;ESR=015
TEXT 48 -208 Left 4 ;Open-Loop Frequency Response of a Buck Converter
TEXT 832 0 Left 2 !.param t0=1m
TEXT 784 -56 Left 2 !.step dec param Freq 100 200k 10
TEXT 64 384 Left 2 !;.save V(out) V(in)\n;.option numdgt=15 ;double precision for data \n;.option nomarch   ;do not plot marching waveform
TEXT 64 512 Left 2 !.measure Aavg avg V(out) ;average output voltage\n.measure Bavg avg V(in)  ;average input signal \n \n.measure Are  avg 2*(V(out)-Aavg)*cos(360*Freq*time) ;A real part\n.measure Aim  avg 2*(V(out)-Aavg)*sin(360*Freq*time) ;A imag part\n \n.measure Bre  avg 2*(V(in) -Bavg)*cos(360*Freq*time) ;B real part\n.measure Bim  avg 2*(V(in) -Bavg)*sin(360*Freq*time) ;B imag part
TEXT 1056 488 Left 2 !.measure Amag param hypot(Are,Aim) ; A magnitude \n.measure Bmag param hypot(Bre,Bim) ; B magnitude\n \n.measure Aphi param atan2(Are,Aim) ; A phase\n.measure Bphi param atan2(Bre,Bim) ; B phase\n \n.measure GainMag param 20*log10(Amag/Bmag) ; Gain magnitude \n.measure GainPhi param Bphi-Aphi           ; Gain phase
